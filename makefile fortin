# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    makefile fortin                                    :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: rbalbous <rbalbous@student.42.fr>          +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2017/07/30 17:14:16 by jfortin           #+#    #+#              #
#    Updated: 2018/03/14 17:28:44 by rbalbous         ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

ifeq ($(DEBUG),yes)
    CFLAGS += -g -DDEBUG -fsanitize=address
else
    CFLAGS += -O3
endif
NAME = scop
MYBASH = ~/.zshrc
DYLIB = SDL2/build/.libs/
ENVLINE := $(shell cat $(MYBASH) | grep "export DYLD_LIBRARY_PATH=")
LIBFT = libft/libft.a
MATH = math_3d/libmath_3d.a
SDL2 = SDL2/build/.libs/libSDL2-2.0.0.dylib
FRAMEWORK = -framework OpenGL -framework AppKit
SRC_NAME =  create_gl_program.c \
            create_gl_ressources_model.c \
            create_gl_ressources_skybox.c \
            load_bmp.c \
            main.c \
            mouse_move.c \
            parser_obj.c \
            process_event.c \
            utils.c
SRC_DIR = src
BUILD_DIR = obj
OBJ = $(addprefix $(BUILD_DIR)/,$(SRC_NAME:.c=.o))
DPD = $(addprefix $(BUILD_DIR)/, $(SRC_NAME:.c=.d))
SRC = $(addprefix $(SRC_DIR)/,$(SRC_NAME))
opti:
        @$(MAKE) -j8 all
debug:
        @$(MAKE) opti DEBUG=yes
libft:
        @$(MAKE) -C libft all
.PHONY: libft
math_3d:
        @$(MAKE) -C math_3d all
.PHONY: math_3d
$(SDL2):
        cd SDL2 && ./configure --enable-static && $(MAKE)
.PHONY: SDL2
all:
    @$(MAKE) libft
    @$(MAKE) math_3d
    @$(MAKE) $(NAME)
$(NAME): $(LIBFT) $(MATH) $(SDL2) $(OBJ)
        @echo "\033[2K \033[A"
        @gcc $(CFLAGS) -o $(NAME) $(OBJ) $(LIBFT) $(MATH) $(FRAMEWORK) $(SDL2)
        @echo "$(NAME) created"
ifneq ($(DYLIB), $(findstring $(DYLIB), $(ENVLINE)))
    echo 'export DYLD_LIBRARY_PATH="SDL2/build/.libs/"' >> $(MYBASH)
    @echo relaunch your shell for apply changes
endif
$(BUILD_DIR)/%.o: $(SRC_DIR)/%.c
        @mkdir -p $(BUILD_DIR)
        @echo "\033[2K [$(NAME)]: Compilation of $< \033[A"
        @gcc $(CFLAGS) -I includes -c $< -o $@
clean:
        @$(MAKE) clean -C libft
        @$(MAKE) clean -C math_3d
        @$(MAKE) clean -C SDL2
        @rm -rf $(BUILD_DIR)
        @echo "[$(NAME)]: OBJ deleted"
fclean: clean
        @rm -f $(LIBFT)
        @echo "[$(LIBFT)]: deleted"
        @rm -f $(MATH)
        @echo "[$(MATH)]: deleted"
        @rm -f $(NAME)
        @echo "[$(NAME)]: deleted"
re : fclean opti
uninstall:
        @echo $(ENVLINE)
        @cat $(MYBASH) | grep -v "export DYLD_LIBRARY_PATH=" > temp; mv temp $(MYBASH)
.PHONY: all, clean, fclean, re
-include $(DPD)


Add CommentCollapseÂ 

Message Input

Message @afoures 